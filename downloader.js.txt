const axios = require('axios');
const fs = require('fs');
const path = require('path');

// The URL of the raw text file from the FDA
const fdaUrl = 'https://download.open.fda.gov/drug/ndc/labeler/labeler.txt';

// The path where we will save the file on the server
const outputPath = path.join(__dirname, 'labeler.txt');

async function downloadData() {
  console.log('üöö Starting download of FDA data...');
  try {
    const response = await axios({
      method: 'get',
      url: fdaUrl,
      responseType: 'stream',
    });

    const writer = fs.createWriteStream(outputPath);
    response.data.pipe(writer);

    return new Promise((resolve, reject) => {
      writer.on('finish', () => {
        console.log('‚úÖ FDA data successfully downloaded to labeler.txt');
        resolve();
      });
      writer.on('error', reject);
    });

  } catch (error) {
    console.error('‚ùå Error downloading FDA data:', error.message);
    process.exit(1); // Exit with an error code
  }
}

// Run the download function
downloadData();